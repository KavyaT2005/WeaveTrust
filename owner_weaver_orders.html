<!DOCTYPE html>
<html>
<head>
    <title>Weaver Orders</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body{
            margin:0;
            font-family:Arial, sans-serif;
            background:#f4f6f9;
        }

        .top{
            background:#3b73d1;
            color:white;
            padding:15px 20px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            font-size:18px;
        }

        .container{
            padding:30px;
        }

        table{
            width:100%;
            border-collapse:collapse;
            background:white;
            box-shadow:0 6px 16px rgba(0,0,0,0.1);
            border-radius:10px;
            overflow:hidden;
        }

        th, td{
            padding:12px;
            border-bottom:1px solid #eee;
            text-align:center;
        }

        th{
            background:#f1f4f8;
        }

        .badge{
            padding:6px 12px;
            border-radius:20px;
            font-size:13px;
        }

        .inprogress{
            background:#ffe9b3;
            color:#8a5a00;
        }

        .completed{
            background:#d4f4dd;
            color:#187a3c;
        }

        .graph-card{
            margin-top:30px;
            background:white;
            padding:20px;
            border-radius:12px;
            box-shadow:0 6px 16px rgba(0,0,0,0.1);
            width:520px;
        }
    </style>
</head>

<body>

<div class="top">
    Orders for Weaver: {{ weaver_name }}
    <a href="/owner" style="color:white;text-decoration:none">← Back</a>
</div>

<div class="container">

    <h2>Orders</h2>
    <table>
        <tr>
            <th>ID</th>
            <th>Cloth</th>
            <th>Total</th>
            <th>Produced</th>
            <th>Status</th>
        </tr>

        {% for o in orders %}
        <tr>
            <td>{{ o.id }}</td>
            <td>{{ o.cloth }}</td>
            <td>{{ o.meters }}</td>
            <td>{{ o.produced }}</td>
            <td>
                {% if o.status == "Completed" %}
                    <span class="badge completed">Completed</span>
                {% else %}
                    <span class="badge inprogress">In Progress</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    {% if performance %}
    <div class="graph-card">
        <b>Performance Graph</b>
        <div style="height:220px;">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>
    {% endif %}
</div>

{% if performance %}
<!-- ✅ SAFE JSON HOLDER -->
<script type="application/json" id="performance-data">
{{ performance | tojson }}
</script>

<script>
    const perfData = JSON.parse(
        document.getElementById("performance-data").textContent
    );

    const labels = perfData.map(p => p.date);
    const values = perfData.map(p => p.total);

    const ctx = document.getElementById("performanceChart").getContext("2d");

    new Chart(ctx, {
        type: "line",
        data: {
            labels: labels,
            datasets: [{
                data: values,
                borderColor: "#ff8c00",
                backgroundColor: "rgba(255,140,0,0.2)",
                fill: true,
                tension: 0.3,
                pointRadius: 6,
                pointBackgroundColor: "#ff8c00",
                pointBorderColor: "#000",
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true },
                x: {}
            }
        }
    });
</script>
{% endif %}

</body>
</html>
