<!DOCTYPE html>
<html>
<head>
<title>Orders from {{ owner_name }}</title>

<style>
body{
    margin:0;
    background:#f4f6f9;
    font-family:Arial, sans-serif;
}

.top{
    background:#3b73d1;
    color:white;
    padding:16px 24px;
    font-size:18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.container{
    padding:30px;
}

table{
    width:100%;
    background:white;
    border-collapse:collapse;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    margin-bottom:20px;
}

td,th{
    padding:12px;
    border:1px solid #ddd;
    text-align:center;
}

th{
    background:#f1f4f8;
}

.badge{
    padding:6px 12px;
    border-radius:20px;
    font-size:13px;
}

.completed{
    background:#d4f4dd;
    color:#187a3c;
}

.inprogress{
    background:#ffe9b3;
    color:#8a5a00;
}

.summary{
    font-size:18px;
    font-weight:bold;
    margin-top:10px;
}
</style>
</head>

<body>

<div class="top">
    Orders from {{ owner_name }}
    <a href="/weaver" style="color:white;text-decoration:none">‚Üê Back</a>
</div>

<div class="container">

<h2>Your Orders</h2>

{% set total_earnings = 0 %}

<table>
<tr>
    <th>ID</th>
    <th>Cloth</th>
    <th>Total</th>
    <th>Produced</th>
    <th>Rate</th>
    <th>Your Earnings</th>
    <th>Status</th>
    <th>Update</th>
</tr>

{% for o in orders %}
{% set earnings = o.produced * o.rate %}
{% set total_earnings = total_earnings + earnings %}

<tr>
    <td>{{ o.id }}</td>
    <td>{{ o.cloth }}</td>
    <td>{{ o.meters }}</td>
    <td>{{ o.produced }}</td>
    <td>‚Çπ{{ o.rate }}</td>
    <td><strong>‚Çπ{{ earnings }}</strong></td>
    <td>
        {% if o.status == "Completed" %}
            <span class="badge completed">Completed</span>
        {% else %}
            <span class="badge inprogress">In Progress</span>
        {% endif %}
    </td>
    <td>
        {% if o.status != "Completed" %}
        <form method="post" style="display:flex; gap:5px; justify-content:center;">
            <input type="hidden" name="order_id" value="{{ o.id }}">
            <input type="number" name="meters" placeholder="Add meters" required>
            <button type="submit">Update</button>
        </form>
        {% else %}
        ‚Äî
        {% endif %}
    </td>
</tr>
{% endfor %}
</table>

<div class="summary">
    üí∞ Total Earnings from {{ owner_name }}: ‚Çπ{{ total_earnings }}
</div>

<br>

<h2>Production History</h2>

<table>
<tr>
    <th>Order ID</th>
    <th>Cloth</th>
    <th>Date</th>
    <th>Meters Added</th>
</tr>

{% if history %}
    {% for h in history %}
    <tr>
        <td>{{ h.order_id }}</td>
        <td>{{ h.cloth }}</td>
        <td>{{ h.date }}</td>
        <td>{{ h.meters }}</td>
    </tr>
    {% endfor %}
{% else %}
    <tr>
        <td colspan="4">No production history</td>
    </tr>
{% endif %}
</table>

</div>

</body>
</html>
